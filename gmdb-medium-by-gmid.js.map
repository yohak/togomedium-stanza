{"version":3,"file":"gmdb-medium-by-gmid.js","sources":["../../../home/runner/work/togomedium-stanza/togomedium-stanza/stanzas/gmdb-medium-by-gmid/index.ts"],"sourcesContent":["import Stanza from \"togostanza/stanza\";\nimport { getData } from \"../../utils/getData\";\nimport { importWebFontForTogoMedium } from \"../../utils/stanza\";\nimport { ApiResponse, TemplateBase } from \"../../utils/types\";\nimport { API_GROWTH_MEDIUM } from \"../../utils/variables\";\n\nexport default class GmdbMediumByGmid extends Stanza<StanzaParameters> {\n  async render() {\n    const params = this.params;\n    if (!params.gm_id) {\n      return;\n    }\n    const apiName = \"gmdb_medium_by_gmid\";\n    const result = await getData<ApiBody>(`${API_GROWTH_MEDIUM}${apiName}`, {\n      gm_id: params.gm_id,\n    });\n    const parameters = parseData(result, params);\n    const template = \"stanza.html.hbs\";\n    this.renderTemplate<TemplateParameters>({ template, parameters });\n    importWebFontForTogoMedium(this);\n  }\n}\n\nconst parseData = (data: ApiResponse<ApiBody>, params: StanzaParameters): TemplateParameters => {\n  switch (true) {\n    case data.status !== 200:\n      return makeErrorData(`Error ${data.status}<br />${data.message}`);\n    case !data?.body?.meta:\n      return makeErrorData(`No Medium Found with ${params.gm_id}`);\n    default:\n      return makeSuccessData(data.body!);\n  }\n};\n\nconst makeErrorData = (msg: string): TemplateParameters => {\n  return {\n    id: undefined,\n    name: undefined,\n    src_url: undefined,\n    src_label: undefined,\n    ph: undefined,\n    components: [],\n    error: true,\n    statusText: msg,\n  };\n};\n\nconst makeSuccessData = (body: ApiBody): TemplateParameters => {\n  return {\n    id: body.meta.gm.split(\"/\").pop(),\n    name: body.meta.name,\n    src_label: getSrcLabel(body.meta.src_url),\n    src_url: body.meta.src_url,\n    ph: body.meta.ph,\n    components: [\n      ...processComponentTables(body.components),\n      ...processComponentComments(body.comments),\n    ].sort((a, b) => a.paragraph_index - b.paragraph_index),\n  };\n};\n\nconst processComponentTables = (tables: ComponentTable[]): ComponentTable[] => {\n  return tables.map((table) => ({\n    ...table,\n    items: table.items.map((item) => ({\n      ...item,\n      // component_name: \"MgCl<sup>2</sup>&middot;6H<sub>2</sub>O\",\n      can_wrap_label: item.label?.length >= 20,\n      can_wrap_name: item.component_name?.length >= 20,\n      properties: item.properties.map((property) => ({\n        ...property,\n        displayLabel: getShortPropertyLabel(property.label),\n      })),\n    })),\n  }));\n};\nconst processComponentComments = (comments: ComponentComment[]): ComponentComment[] => {\n  return comments.map((item) => ({\n    ...item,\n    comment: item.comment ? item.comment : \"&nbsp;\",\n  }));\n};\n\nfunction getShortPropertyLabel(str: string): string {\n  const dic: { [key: string]: string } = {\n    \"Simple component\": \"Simple\",\n    \"Complex component\": \"Complex\",\n    \"Defined component\": \"Defined\",\n    \"Undefined component\": \"Undefined\",\n    \"Inorganic compound\": \"Inorganic\",\n    \"Organic compound\": \"Organic\",\n    Solution: \"Solution\",\n  };\n  if (!dic[str]) {\n    console.warn(\"no short property label found:\", str);\n  }\n  return dic[str] ? dic[str] : \"ERR\";\n}\n\nconst getSrcLabel = (str: string): string => {\n  switch (true) {\n    case str.match(/jcm.*riken/) !== null:\n      return \"JCM\";\n    case str.match(/nite.*nbrc/) !== null:\n      return \"NBRC\";\n    case str.match(/dsmz\\.de/) !== null:\n      return \"DSMZ\";\n    case str.match(/atcc\\.org/) !== null:\n      return \"ATCC\";\n    default:\n      return \"SRC\";\n  }\n};\n\nexport const __TEST__ = { getSrcLabel };\n\ntype StanzaParameters = {\n  gm_id: string;\n};\ntype TemplateParameters = {\n  id: string | undefined;\n  src_url: string | undefined;\n  src_label: string | undefined;\n  name: string | undefined;\n  ph: number | undefined;\n  components: RecipeItem[];\n} & TemplateBase;\n\ntype ApiBody = {\n  meta: Meta;\n  components: ComponentTable[];\n  comments: ComponentComment[];\n};\ntype Meta = {\n  gm: string;\n  name: string;\n  src_url: string;\n  ph: number;\n};\ntype ComponentTable = {\n  subcomponent_name: string;\n  items: Component[];\n} & RecipeItem;\n\ntype Component = {\n  component_name: string;\n  volume: number;\n  unit: string;\n  gmo: string;\n  gmo_id: string;\n  label: string;\n  conc_value?: number;\n  conc_unit?: string;\n  properties: Property[];\n  roles: Role[];\n  can_wrap_name?: boolean;\n  can_wrap_label?: boolean;\n};\n\ntype Property = {} & ComponentFunction;\n\ntype Role = {} & ComponentFunction;\n\ntype ComponentFunction = {\n  label: string;\n  uri: string;\n  id: string;\n  displayLabel?: string;\n};\n\ntype ComponentComment = {\n  comment: string;\n} & RecipeItem;\n\ntype RecipeItem = {\n  paragraph_index: number;\n};\n"],"names":[],"mappings":"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"}