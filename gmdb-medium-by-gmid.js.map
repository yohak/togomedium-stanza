{"version":3,"file":"gmdb-medium-by-gmid.js","sources":["../../../home/runner/work/togomedium-stanza/togomedium-stanza/stanzas/gmdb-medium-by-gmid/index.ts"],"sourcesContent":["import Stanza from \"togostanza/stanza\";\nimport { getData } from \"../../shared/utils/getData\";\nimport { importWebFontForTogoMedium } from \"../../shared/utils/stanza\";\nimport { ApiResponse, TemplateBase } from \"../../shared/utils/types\";\nimport { URL_API } from \"../../shared/utils/variables\";\n\nexport default class GmdbMediumByGmid extends Stanza<StanzaParameters> {\n  async render() {\n    const params = this.params;\n    if (!params.gm_id) {\n      return;\n    }\n    const apiName = \"gmdb_medium_by_gmid\";\n    const result = await getData<ApiBody>(`${URL_API}${apiName}`, {\n      gm_id: params.gm_id,\n    });\n    const parameters = parseData(result, params);\n    const template = \"stanza.html.hbs\";\n    this.renderTemplate<TemplateParameters>({ template, parameters });\n    importWebFontForTogoMedium(this);\n  }\n}\n\nconst parseData = (data: ApiResponse<ApiBody>, params: StanzaParameters): TemplateParameters => {\n  switch (true) {\n    case data.status !== 200:\n      return makeErrorData(`Error ${data.status}<br />${data.message}`);\n    case !data?.body?.meta:\n      return makeErrorData(`No Medium Found with ${params.gm_id}`);\n    default:\n      return makeSuccessData(data.body!);\n  }\n};\n\nconst makeErrorData = (msg: string): TemplateParameters => {\n  return {\n    id: undefined,\n    original_id: undefined,\n    name: undefined,\n    src_url: undefined,\n    src_label: undefined,\n    ph: undefined,\n    components: [],\n    error: true,\n    statusText: msg,\n  };\n};\n\nconst makeSuccessData = (body: ApiBody): TemplateParameters => {\n  return {\n    id: body.meta.gm.split(\"/\").pop(),\n    original_id: body.meta.original_media_id,\n    name: body.meta.name,\n    src_label: getSrcLabel(body.meta.src_url),\n    src_url: body.meta.src_url,\n    ph: body.meta.ph,\n    components: [\n      ...processComponentTables(body.components),\n      ...processComponentComments(body.comments),\n    ].sort((a, b) => a.paragraph_index - b.paragraph_index),\n  };\n};\n\nconst processComponentTables = (tables: ComponentTable[]): ComponentTable[] => {\n  return tables.map((table) => ({\n    ...table,\n    items: table.items.map((item) => ({\n      ...item,\n      // component_name: \"MgCl<sup>2</sup>&middot;6H<sub>2</sub>O\",\n      can_wrap_label: item.label?.length >= 20,\n      can_wrap_name: item.component_name?.length >= 20,\n      properties: item.properties.map((property) => ({\n        ...property,\n        displayLabel: getShortPropertyLabel(property.label),\n      })),\n    })),\n  }));\n};\nconst processComponentComments = (comments: ComponentComment[]): ComponentComment[] => {\n  return comments.map((item) => ({\n    ...item,\n    comment: item.comment ? item.comment : \"&nbsp;\",\n  }));\n};\n\nfunction getShortPropertyLabel(str: string): string {\n  const dic: { [key: string]: string } = {\n    \"Simple component\": \"Simple\",\n    \"Complex component\": \"Complex\",\n    \"Defined component\": \"Defined\",\n    \"Undefined component\": \"Undefined\",\n    \"Inorganic compound\": \"Inorganic\",\n    \"Organic compound\": \"Organic\",\n    Solution: \"Solution\",\n  };\n  if (!dic[str]) {\n    console.warn(\"no short property label found:\", str);\n  }\n  return dic[str] ? dic[str] : \"ERR\";\n}\n\nconst getSrcLabel = (str: string): string => {\n  switch (true) {\n    case str.match(/jcm.*riken/) !== null:\n      return \"JCM\";\n    case str.match(/nite.*nbrc/) !== null:\n      return \"NBRC\";\n    case str.match(/dsmz\\.de/) !== null:\n      return \"DSMZ\";\n    case str.match(/atcc\\.org/) !== null:\n      return \"ATCC\";\n    default:\n      return \"SRC\";\n  }\n};\n\nexport const __TEST__ = { getSrcLabel };\n\ntype StanzaParameters = {\n  gm_id: string;\n};\ntype TemplateParameters = {\n  id: string | undefined;\n  original_id: string | undefined;\n  src_url: string | undefined;\n  src_label: string | undefined;\n  name: string | undefined;\n  ph: number | undefined;\n  components: RecipeItem[];\n} & TemplateBase;\n\ntype ApiBody = {\n  meta: Meta;\n  components: ComponentTable[];\n  comments: ComponentComment[];\n};\ntype Meta = {\n  gm: string;\n  name: string;\n  src_url: string;\n  ph: number;\n  original_media_id?: string;\n};\ntype ComponentTable = {\n  subcomponent_name: string;\n  items: Component[];\n} & RecipeItem;\n\ntype Component = {\n  component_name: string;\n  volume: number;\n  unit: string;\n  gmo: string;\n  gmo_id: string;\n  label: string;\n  conc_value?: number;\n  conc_unit?: string;\n  properties: Property[];\n  roles: Role[];\n  can_wrap_name?: boolean;\n  can_wrap_label?: boolean;\n};\n\ntype Property = {} & ComponentFunction;\n\ntype Role = {} & ComponentFunction;\n\ntype ComponentFunction = {\n  label: string;\n  uri: string;\n  id: string;\n  displayLabel?: string;\n};\n\ntype ComponentComment = {\n  comment: string;\n} & RecipeItem;\n\ntype RecipeItem = {\n  paragraph_index: number;\n};\n"],"names":[],"mappings":"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"}