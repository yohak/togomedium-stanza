{"version":3,"file":"gmdb-organism-by-taxid.js","sources":["../../../home/runner/work/togomedium-stanza/togomedium-stanza/stanzas/gmdb-organism-by-taxid/index.ts"],"sourcesContent":["import Stanza from \"togostanza/stanza\";\nimport { Optional } from \"yohak-tools\";\nimport { getData } from \"../../utils/get-data\";\nimport { importWebFontForTogoMedium } from \"../../utils/stanza\";\nimport { capitalizeFirstLetter, unescapeJsonString } from \"../../utils/string\";\nimport { ApiResponse, TemplateBase } from \"../../utils/types\";\nimport { API_GROWTH_MEDIUM } from \"../../utils/variables\";\n\nexport default class GmdbOrganismByTaxid extends Stanza<StanzaParameters> {\n  async render() {\n    const params = this.params;\n    if (!params.tax_id) {\n      return;\n    }\n    const apiName = \"gmdb_organism_by_taxid\";\n    const result = await getData<ApiBody>(`${API_GROWTH_MEDIUM}${apiName}`, {\n      tax_id: params.tax_id,\n    });\n    // console.log(JSON.parse(JSON.stringify(result)));\n\n    const parameters = parseData(result);\n    const template = \"stanza.html.hbs\";\n    this.renderTemplate<TemplateParameters>({ template, parameters });\n    importWebFontForTogoMedium(this);\n  }\n}\n\nconst parseData = (data: ApiResponse<ApiBody>): TemplateParameters => {\n  return makeSuccessData(data.body!);\n};\n\nconst makeSuccessData = (body: ApiBody): TemplateParameters => ({\n  taxid: body.taxid,\n  scientific_name: body.scientific_name,\n  authority_name: unescapeJsonString(body.authority_name),\n  lineage: parseLineage(body.lineage),\n  type_material: body.type_material,\n  other_type_material: parseOtherTypeMaterial(body.other_type_material),\n});\n\nconst parseLineage = (lineages: Lineage[]): Lineage[] => {\n  return lineages.map((item) => ({\n    ...item,\n    rank: capitalizeFirstLetter(item.rank),\n  }));\n};\n\nconst parseOtherTypeMaterial = (data: TypeMaterial[]): OtherMaterialParameter[] => {\n  return data\n    .map((obj) => obj.name!)\n    .reduce<string[]>((a: string[], b: string) => {\n      if (a.indexOf(b) < 0) {\n        a.push(b);\n      }\n      return a;\n    }, [])!\n    .map((key) => ({\n      key,\n      labels: data.filter((item) => item.name === key).map((elm) => elm.label),\n    }));\n};\n\nexport const __TEST__ = { parseOtherTypeMaterial };\n\ntype StanzaParameters = {\n  tax_id: string;\n};\n\ntype TemplateParameters = {\n  taxid: string;\n  scientific_name: string;\n  authority_name: Optional<string>;\n  lineage: Lineage[];\n  type_material: TypeMaterial[];\n  other_type_material: { key: string; labels: string[] }[];\n} & TemplateBase;\n\ntype OtherMaterialParameter = {\n  key: string;\n  labels: string[];\n};\n\ntype ApiBody = {\n  scientific_name: string;\n  taxid: string;\n  authority_name: string;\n  lineage: Lineage[];\n  type_material: TypeMaterial[];\n  other_type_material: TypeMaterial[];\n};\n\ntype Lineage = {\n  rank: Optional<string>;\n  label: string;\n  uri: string;\n  taxid: string;\n};\n\ntype TypeMaterial = {\n  label: string;\n  name?: string;\n};\n"],"names":[],"mappings":";;;;;;MAQqB,mBAAoB,SAAQ,MAAwB;IACjE,MAAM;;YACV,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;YAC3B,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;gBAClB,OAAO;aACR;YACD,MAAM,OAAO,GAAG,wBAAwB,CAAC;YACzC,MAAM,MAAM,GAAG,MAAM,OAAO,CAAU,GAAG,iBAAiB,GAAG,OAAO,EAAE,EAAE;gBACtE,MAAM,EAAE,MAAM,CAAC,MAAM;aACtB,CAAC,CAAC;YAGH,MAAM,UAAU,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC;YACrC,MAAM,QAAQ,GAAG,iBAAiB,CAAC;YACnC,IAAI,CAAC,cAAc,CAAqB,EAAE,QAAQ,EAAE,UAAU,EAAE,CAAC,CAAC;YAClE,0BAA0B,CAAC,IAAI,CAAC,CAAC;SAClC;KAAA;CACF;AAED,MAAM,SAAS,GAAG,CAAC,IAA0B;IAC3C,OAAO,eAAe,CAAC,IAAI,CAAC,IAAK,CAAC,CAAC;AACrC,CAAC,CAAC;AAEF,MAAM,eAAe,GAAG,CAAC,IAAa,MAA0B;IAC9D,KAAK,EAAE,IAAI,CAAC,KAAK;IACjB,eAAe,EAAE,IAAI,CAAC,eAAe;IACrC,cAAc,EAAE,kBAAkB,CAAC,IAAI,CAAC,cAAc,CAAC;IACvD,OAAO,EAAE,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC;IACnC,aAAa,EAAE,IAAI,CAAC,aAAa;IACjC,mBAAmB,EAAE,sBAAsB,CAAC,IAAI,CAAC,mBAAmB,CAAC;CACtE,CAAC,CAAC;AAEH,MAAM,YAAY,GAAG,CAAC,QAAmB;IACvC,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,sCACpB,IAAI,KACP,IAAI,EAAE,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,IACtC,CAAC,CAAC;AACN,CAAC,CAAC;AAEF,MAAM,sBAAsB,GAAG,CAAC,IAAoB;IAClD,OAAO,IAAI;SACR,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,IAAK,CAAC;SACvB,MAAM,CAAW,CAAC,CAAW,EAAE,CAAS;QACvC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE;YACpB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;SACX;QACD,OAAO,CAAC,CAAC;KACV,EAAE,EAAE,CAAE;SACN,GAAG,CAAC,CAAC,GAAG,MAAM;QACb,GAAG;QACH,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,KAAK,CAAC;KACzE,CAAC,CAAC,CAAC;AACR,CAAC,CAAC;AAEK,MAAM,QAAQ,GAAG,EAAE,sBAAsB,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}